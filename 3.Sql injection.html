<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Injection - Gu√≠a Completa</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #764ba2;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .content-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .content-card:hover {
            transform: translateY(-5px);
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .vulnerable {
            border-left: 4px solid #e74c3c;
        }

        .secure {
            border-left: 4px solid #27ae60;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .exercise {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .exercise-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .solution {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
        }

        ul, ol {
            margin-left: 25px;
            margin-top: 10px;
        }

        li {
            margin: 8px 0;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: white;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .content-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è SQL Injection</h1>
            <p class="subtitle">Gu√≠a completa para entender, prevenir y mitigar ataques de inyecci√≥n SQL</p>
        </header>

        <div class="content-card">
            <h2>¬øQu√© es SQL Injection?</h2>
            <p>SQL Injection (Inyecci√≥n SQL) es una vulnerabilidad de seguridad que permite a un atacante interferir con las consultas SQL que una aplicaci√≥n realiza a su base de datos. Es una de las vulnerabilidades m√°s cr√≠ticas en aplicaciones web.</p>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Advertencia:</strong> SQL Injection puede permitir a atacantes:
                <ul>
                    <li>Leer datos sensibles de la base de datos</li>
                    <li>Modificar o eliminar datos</li>
                    <li>Ejecutar operaciones administrativas</li>
                    <li>Obtener acceso completo al sistema</li>
                </ul>
            </div>
        </div>

        <div class="content-card">
            <h2>C√≥mo Funciona</h2>
            <p>El ataque ocurre cuando la entrada del usuario se inserta directamente en una consulta SQL sin validaci√≥n o sanitizaci√≥n adecuada.</p>
            
            <h3>Ejemplo de C√≥digo Vulnerable</h3>
            <div class="code-block vulnerable">
// PHP - VULNERABLE ‚ùå
$username = $_POST['username'];
$password = $_POST['password'];

$query = "SELECT * FROM users WHERE username = '$username' AND password = '$password'";
$result = mysqli_query($conn, $query);
            </div>

            <h3>Ataque de Ejemplo</h3>
            <p>Un atacante podr√≠a ingresar:</p>
            <div class="code-block">
Username: admin' --
Password: cualquier_cosa
            </div>

            <p>La consulta resultante ser√≠a:</p>
            <div class="code-block">
SELECT * FROM users WHERE username = 'admin' -- ' AND password = 'cualquier_cosa'
            </div>

            <div class="info">
                <strong>üí° Explicaci√≥n:</strong> El s√≠mbolo <span class="highlight">--</span> es un comentario en SQL, por lo que todo lo que viene despu√©s se ignora. Esto permite al atacante autenticarse sin conocer la contrase√±a.
            </div>
        </div>

        <div class="content-card">
            <h2>Tipos de SQL Injection</h2>
            
            <h3>1. In-band SQL Injection</h3>
            <p>El atacante recibe la respuesta directamente en la misma aplicaci√≥n.</p>
            <ul>
                <li><strong>Error-based:</strong> Usa mensajes de error para obtener informaci√≥n</li>
                <li><strong>Union-based:</strong> Usa la cl√°usula UNION para combinar resultados</li>
            </ul>

            <h3>2. Blind SQL Injection</h3>
            <p>La aplicaci√≥n no muestra errores, pero el atacante deduce informaci√≥n por el comportamiento.</p>
            <ul>
                <li><strong>Boolean-based:</strong> Env√≠a consultas que retornan verdadero o falso</li>
                <li><strong>Time-based:</strong> Usa retrasos para inferir informaci√≥n</li>
            </ul>

            <h3>3. Out-of-band SQL Injection</h3>
            <p>Los datos se extraen usando canales diferentes (DNS, HTTP).</p>
        </div>

        <div class="content-card">
            <h2>Ejemplos de Ataques Comunes</h2>

            <h3>Bypass de Autenticaci√≥n</h3>
            <div class="code-block vulnerable">
-- Consulta vulnerable
SELECT * FROM users WHERE username = 'admin' AND password = 'pass123'

-- Ataque
username: admin' OR '1'='1
password: admin' OR '1'='1

-- Resultado
SELECT * FROM users WHERE username = 'admin' OR '1'='1' AND password = 'admin' OR '1'='1'
            </div>

            <h3>Extracci√≥n de Datos con UNION</h3>
            <div class="code-block vulnerable">
-- URL vulnerable
https://ejemplo.com/productos?id=5

-- Ataque
https://ejemplo.com/productos?id=5' UNION SELECT username, password FROM users --

-- Consulta resultante
SELECT nombre, precio FROM productos WHERE id = '5' UNION SELECT username, password FROM users --'
            </div>

            <h3>Blind SQL Injection con Time Delay</h3>
            <div class="code-block vulnerable">
-- Ataque
username: admin' AND SLEEP(5) --

-- Si la p√°gina tarda 5 segundos, el usuario 'admin' existe
            </div>
        </div>

        <div class="content-card">
            <h2>Prevenci√≥n y Mitigaci√≥n</h2>

            <h3>1. Consultas Preparadas (Prepared Statements) ‚úÖ</h3>
            <p>La forma m√°s efectiva de prevenir SQL Injection.</p>

            <div class="code-block secure">
// PHP con PDO - SEGURO ‚úÖ
$stmt = $pdo->prepare('SELECT * FROM users WHERE username = ? AND password = ?');
$stmt->execute([$username, $password]);
$user = $stmt->fetch();
            </div>

            <div class="code-block secure">
// Node.js con MySQL - SEGURO ‚úÖ
const query = 'SELECT * FROM users WHERE username = ? AND password = ?';
connection.query(query, [username, password], (error, results) => {
    if (error) throw error;
    console.log(results);
});
            </div>

            <div class="code-block secure">
// Python con SQLite - SEGURO ‚úÖ
cursor.execute('SELECT * FROM users WHERE username = ? AND password = ?', (username, password))
results = cursor.fetchall()
            </div>

            <h3>2. Stored Procedures ‚úÖ</h3>
            <div class="code-block secure">
-- Crear procedimiento almacenado
CREATE PROCEDURE GetUser
    @username VARCHAR(50),
    @password VARCHAR(50)
AS
BEGIN
    SELECT * FROM users WHERE username = @username AND password = @password
END
            </div>

            <h3>3. Validaci√≥n de Entrada ‚úÖ</h3>
            <div class="code-block secure">
// JavaScript - Validaci√≥n
function sanitizeInput(input) {
    // Permitir solo caracteres alfanum√©ricos
    return input.replace(/[^a-zA-Z0-9]/g, '');
}

// Usar whitelist para validar
const allowedChars = /^[a-zA-Z0-9_-]+$/;
if (!allowedChars.test(username)) {
    throw new Error('Username inv√°lido');
}
            </div>

            <h3>4. Principio de M√≠nimo Privilegio ‚úÖ</h3>
            <div class="info">
                <strong>üí° Buena Pr√°ctica:</strong>
                <ul>
                    <li>Usar cuentas de base de datos con permisos limitados</li>
                    <li>No usar cuenta 'root' o 'sa' en aplicaciones</li>
                    <li>Otorgar solo los permisos necesarios (SELECT, INSERT, UPDATE)</li>
                    <li>Denegar permisos de DROP, CREATE, ALTER</li>
                </ul>
            </div>

            <h3>5. Escapar Caracteres Especiales (√öltimo Recurso)</h3>
            <div class="code-block secure">
// PHP - Escapar (NO RECOMENDADO como √∫nica defensa)
$username = mysqli_real_escape_string($conn, $_POST['username']);
$password = mysqli_real_escape_string($conn, $_POST['password']);

// Mejor usar prepared statements
            </div>
        </div>

        <div class="content-card">
            <h2>Ejercicios Pr√°cticos</h2>

            <div class="exercise">
                <div class="exercise-title">Ejercicio 1: Identificar Vulnerabilidades</div>
                <p>Analiza el siguiente c√≥digo e identifica las vulnerabilidades:</p>
                <div class="code-block">
// Node.js Express
app.post('/login', (req, res) => {
    const user = req.body.username;
    const pass = req.body.password;
    
    const query = `SELECT * FROM users WHERE username = '${user}' AND password = '${pass}'`;
    
    db.query(query, (err, result) => {
        if (result.length > 0) {
            res.send('Login exitoso');
        } else {
            res.send('Credenciales inv√°lidas');
        }
    });
});
                </div>
                <button onclick="toggleSolution('sol1')">Ver Soluci√≥n</button>
                <div id="sol1" class="solution">
                    <strong>Vulnerabilidades encontradas:</strong>
                    <ol>
                        <li>Concatenaci√≥n directa de variables en la consulta SQL</li>
                        <li>No hay validaci√≥n de entrada</li>
                        <li>No se usan prepared statements</li>
                        <li>Contrase√±a aparentemente en texto plano</li>
                    </ol>
                    <strong>C√≥digo corregido:</strong>
                    <div class="code-block">
app.post('/login', (req, res) => {
    const user = req.body.username;
    const pass = req.body.password;
    
    // Validar entrada
    if (!/^[a-zA-Z0-9_]+$/.test(user)) {
        return res.status(400).send('Username inv√°lido');
    }
    
    // Usar prepared statement
    const query = 'SELECT * FROM users WHERE username = ? AND password_hash = ?';
    
    db.query(query, [user, hashPassword(pass)], (err, result) => {
        if (err) {
            return res.status(500).send('Error del servidor');
        }
        if (result.length > 0) {
            res.send('Login exitoso');
        } else {
            res.send('Credenciales inv√°lidas');
        }
    });
});
                    </div>
                </div>
            </div>

            <div class="exercise">
                <div class="exercise-title">Ejercicio 2: Refactorizar C√≥digo Vulnerable</div>
                <p>Convierte este c√≥digo vulnerable en c√≥digo seguro usando prepared statements:</p>
                <div class="code-block">
// Python Flask
@app.route('/search', methods=['GET'])
def search():
    search_term = request.args.get('q')
    query = f"SELECT * FROM products WHERE name LIKE '%{search_term}%'"
    cursor.execute(query)
    results = cursor.fetchall()
    return jsonify(results)
                </div>
                <button onclick="toggleSolution('sol2')">Ver Soluci√≥n</button>
                <div id="sol2" class="solution">
                    <strong>C√≥digo seguro:</strong>
                    <div class="code-block">
@app.route('/search', methods=['GET'])
def search():
    search_term = request.args.get('q', '')
    
    # Validar entrada
    if not search_term or len(search_term) > 100:
        return jsonify({'error': 'T√©rmino de b√∫squeda inv√°lido'}), 400
    
    # Usar prepared statement con par√°metro
    query = "SELECT * FROM products WHERE name LIKE ?"
    search_pattern = f"%{search_term}%"
    
    cursor.execute(query, (search_pattern,))
    results = cursor.fetchall()
    
    return jsonify(results)
                    </div>
                </div>
            </div>

            <div class="exercise">
                <div class="exercise-title">Ejercicio 3: Crear Funci√≥n de Validaci√≥n</div>
                <p>Crea una funci√≥n que valide entradas antes de usarlas en consultas SQL.</p>
                <button onclick="toggleSolution('sol3')">Ver Soluci√≥n</button>
                <div id="sol3" class="solution">
                    <div class="code-block">
// JavaScript
class InputValidator {
    static validateUsername(username) {
        if (typeof username !== 'string') {
            throw new Error('Username debe ser string');
        }
        
        if (username.length < 3 || username.length > 50) {
            throw new Error('Username debe tener entre 3 y 50 caracteres');
        }
        
        // Solo alfanum√©ricos, guion y guion bajo
        if (!/^[a-zA-Z0-9_-]+$/.test(username)) {
            throw new Error('Username contiene caracteres inv√°lidos');
        }
        
        return username;
    }
    
    static validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            throw new Error('Email inv√°lido');
        }
        return email.toLowerCase();
    }
    
    static validateId(id) {
        const numId = parseInt(id);
        if (isNaN(numId) || numId < 1) {
            throw new Error('ID inv√°lido');
        }
        return numId;
    }
}

// Uso
try {
    const username = InputValidator.validateUsername(req.body.username);
    const stmt = db.prepare('SELECT * FROM users WHERE username = ?');
    const user = stmt.get(username);
} catch (error) {
    res.status(400).send(error.message);
}
                    </div>
                </div>
            </div>
        </div>

        <div class="content-card">
            <h2>Checklist para Desarrollo Seguro</h2>
            <ul>
                <li>‚úÖ Usar siempre prepared statements o consultas parametrizadas</li>
                <li>‚úÖ Validar y sanitizar toda entrada del usuario</li>
                <li>‚úÖ Usar whitelist de caracteres permitidos</li>
                <li>‚úÖ Implementar principio de m√≠nimo privilegio en la BD</li>
                <li>‚úÖ No mostrar errores de SQL al usuario final</li>
                <li>‚úÖ Implementar logging de consultas sospechosas</li>
                <li>‚úÖ Usar ORM (Object-Relational Mapping) cuando sea apropiado</li>
                <li>‚úÖ Realizar pruebas de seguridad y auditor√≠as regulares</li>
                <li>‚úÖ Mantener frameworks y librer√≠as actualizadas</li>
                <li>‚úÖ Implementar rate limiting en endpoints cr√≠ticos</li>
            </ul>
        </div>

        <div class="content-card">
            <h2>Herramientas de Testing</h2>
            <p>Para probar la seguridad de tus aplicaciones contra SQL Injection:</p>
            <ul>
                <li><strong>SQLMap:</strong> Herramienta de prueba de penetraci√≥n autom√°tica</li>
                <li><strong>Burp Suite:</strong> Proxy para testing de seguridad web</li>
                <li><strong>OWASP ZAP:</strong> Scanner de seguridad gratuito</li>
                <li><strong>sqlninja:</strong> Tool de explotaci√≥n SQL Injection</li>
            </ul>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Importante:</strong> Solo usa estas herramientas en tus propias aplicaciones o con permiso expl√≠cito. El testing sin autorizaci√≥n es ilegal.
            </div>
        </div>

        <footer>
            <p>üíª Desarrolla aplicaciones seguras desde el inicio</p>
            <p>Mant√©n tus sistemas actualizados y realiza auditor√≠as regulares</p>
        </footer>
    </div>

    <script>
        function toggleSolution(id) {
            const solution = document.getElementById(id);
            if (solution.style.display === 'none' || solution.style.display === '') {
                solution.style.display = 'block';
            } else {
                solution.style.display = 'none';
            }
        }
    </script>
</body>
</html>